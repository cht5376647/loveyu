<style type="text/css">

.index-goods-config {border:2px solid #f60;background:#fff;}
.tableform td {}
#maxKeys .delete {height:20px;width:16px;cursor:pointer;float:left;	_display:inline;margin-left:5px;background-color:#fff}
#maxKeys .top-link-item {background-color:#E2E8EB;padding:5px 5px 3px;line-height:22px;	margin:2px 0;}
#maxKeys ul {clear:both}
#maxKeys li {float:left;_display:inline;margin-left:5px; padding-bottom:5px;}
.span-auto{ padding-bottom:5px}
button.sbtn,button.nbtn,button.nbtnb,button.nbtns{ border:1px solid #ddd; background:#f9f9f9; padding:0 5px}
</style>
<div id="goods_shopmax_config" class="tableform">
	<div class="division">
	  <label> 版块classname: </label>
	  <input type="text" class="x-input" name="block_class" value="<{$setting.block_class}>"/><em class="note"><{t app='content'}>设计师专用，非设计师请不要修改本项参数。<{/t}></em> 
	</div>
	<div class="division">
		<div class="span-auto">
			<label>版块标题:</label>
			<input type="text" name="block_name" class="x-input" value="<{$setting.block_name}>" style="width:150px;"/>
		</div>
		<div class="span-auto">
			<label>标题链接:</label>
			<input type="text" name="title_url" class="x-input" value="<{$setting.title_url}>" style="width:150px;"/>
		</div>
	</div>
	<h4> 右侧链接设置：<font color="red">如果给链接的样式名设置为maxMore，该链接将被作为整个楼层的更多按钮</font></h4>
    <div id="more_link" class="division clearfix" >
		<div id="maxKeys">
			<br />
			<{button label=$___b2c="添加链接到前面"|t:'b2c' onclick="maxAddKeys(0);" app="desktop" icon="btn_add.gif"}>

			&nbsp;&nbsp;&nbsp;<{button label=$___b2c="添加链接到后面"|t:'b2c' onclick="maxAddKeys(-1);" app="desktop" icon="btn_add.gif"}><br />
			<br />
			<div id="maxcTitle"></div>
			<{if $setting.keys}>
			<{foreach from=$setting.keys item=keys key=key}>
			<ul class="items">
			  <li >栏目标题
				<input class="x-input" type="text" name="keys[<{$key}>][text]" style="width:80px" value="<{$keys.text}>">
			  </li>
			  <li >链接
				<input class="x-input" type="text" name="keys[<{$key}>][url]" value="<{$keys.url}>" style="width:100px">
			  </li>
			  <li >样式名
				<input class="x-input" type="text" name="keys[<{$key}>][mcname]" style="width:80px" value="<{$keys.mcname}>">
			  </li>
			  <li >新窗口<input  type="checkbox" name="keys[<{$key}>][target]" value="_blank" <{if $keys.target=='_blank'}> checked<{/if}>></li>
			  <li >
				<button class="btn" type="button" onclick="maxAddKeys(this);"><span><span>在此项后填加</span></span></button>
			  </li>
			  <li ><span class="delete" title="删除" onclick="delLink(this)" style="cursor:pointer;"></span></li>
			</ul>
			<{/foreach}>
			<{/if}>
		</div>
	</div>


	<h4>广告图片设置：</h4>
	<div  class="division clearfix" >
      <textarea class="ad" style="display:none;">
		<input type="hidden" name="ad[{_id}][id]" value="{_id}" />
		     	<div class="span-auto">
		  	        <label>图片地址：<input type="text" name="ad[{_id}][pic]" value="" class="x-input" style="width:100px"/>
		  	       <button class="btn sbtn" type="button">选择图片</button></label>
		   	</div>
		  	  <div class="span-auto">
		  	        <label>链接地址：<input type="text" name="ad[{_id}][target_url]" value="" class="x-input" style="width:100px" /></label>
		  	</div>
			<div class="span-auto">
		  	        <label>广告说明：<input type="text" name="ad[{_id}][note]" value="" class="x-input" style="width:50px"/></label>
		  	</div>
			<div class="span-auto">
		  	      图片宽：<input type="text" name="ad[{_id}][width]" value="" class="x-input" style="width:20px"/>px&nbsp;&nbsp;
					图片高：<input type="text" name="ad[{_id}][height]" value="" class="x-input" style="width:20px"/>px
		  	</div>
		  	<div class="frt">
			      <span class="del-btn lnk">
		  		[-]&nbsp;删除
		  	       </span>
		  	</div>
		</textarea>
      <{if count($setting.ad)>0}>
      <{foreach from=$setting.ad item=ad}>
      <div class="division clearfix">
        <input class="x-input" type="hidden" name="ad[<{$ad.id}>][id]" value="<{$ad.id}>"/>
        <div class="span-auto">
          <label>图片地址：<input class="x-input" type="text" name="ad[<{$ad.id}>][pic]" value="<{$ad.pic}>" style="width:100px"/><button class="btn sbtn" type="button">选择图片</button> </label>
        </div>

        <div class="span-auto">
          <label>链接地址：<input class="x-input" type="text" name="ad[<{$ad.id}>][target_url]" value="<{$ad.target_url}>" style="width:100px"/>
          </label>
        </div>

        <div class="span-auto">
          <label>广告说明：<input class="x-input" type="text" name="ad[<{$ad.id}>][note]" value="<{$ad.note}>" style="width:50px"/>
          </label>
        </div>
		<div class="span-auto">
		  	        图片宽：<input type="text" name="ad[<{$ad.id}>][width]" value="<{$ad.width}>" class="x-input" style="width:20px"/>px&nbsp;&nbsp;
					图片高：<input type="text" name="ad[<{$ad.id}>][height]" value="<{$ad.height}>" class="x-input" style="width:20px"/>px
		  	</div>
        <div class="frt"><span class="del-btn lnk"> [-]&nbsp;删除 </span> </div>
      </div>
      <{/foreach}>

      <{/if}>
      <hr id="hr"/>
      <button class="lnk btn nbtn" type="button">[+]添加一项</button>
	</div>
	<h4>中间商品设置：</h4>
	<div class="division clearfix" >
		  <div class="span-auto">
			<label>
			最多展示数量：</label>
			<input type="text"  name="limit"  value="<{$setting.limit}>" />
			个商品
			</div>
			<div class="span-auto">
			  <label>
			标题最大行数：</label>
			<input type="text"  name="titleHeight"  value="<{$setting.titleHeight|default:'5'}>" />
			行
			 </div><div class="span-auto">
			  <label>
		   不显示市场价：</label>
			<input type="checkbox"   name="show_mktprice" value="1"  <{if $setting.show_mktprice}>checked<{/if}> />
		   </div>
      </div>
      <div class="goods-selector-handle clearfix">
        <div class="span-auto">
          <label> <input type="radio"  name="selector" value="filter"  <{if $setting.selector=="filter"}>checked<{/if}> />&nbsp;范围选择商品 </label>
        </div>
        <div class="span-auto">
          <label><input type="radio"  name="selector" value="select"  <{if $setting.selector=="select"}>checked<{/if}> />&nbsp;精确选择商品</label>
        </div>
      </div>
      <div class="division goods-selector">
		  <div data-extend = "filter" <{if $setting.selector=="select"}>style="display:none"<{/if}>>
			<{input type="goodsfilter"  name="goods_filter"  value=$setting.goods_filter}>
			<div class="division"> 排序规则：
			  <select  name="goods_order_by">
				<{foreach from=$data.goods_order_by item=item}> <option value="<{$item.condition}>"  <{if $setting.goods_order_by == $item.condition}>selected<{/if}>><{$item.label}>
				</option>
				<{/foreach}>
			  </select>
			</div>
		  </div>
		  <div data-extend = "select"  <{if $setting.selector=="filter"}>style="display:none;"<{/if}>>
			 <{input type="goods_select"
					  object="goods@b2c"
					  filter=$goodslink_filter
					  multiple="true"
					  return_url="{$related_return_url}"
					  rowselect="true"
					  textcol="name"
					  name="goods_select"
					  linkid=$setting.goods_select
					  value=$setting.goods
					  view="b2c:admin/goods/detail/rel_items.html"
					  }>
		  </div>
     </div>
</div>
<script>
(function(){
	var load_photo_collect = function(target){
		var url='index.php?app=desktop&act=alertpages&goto='+encodeURIComponent("index.php?app=image&ctl=admin_manage&act=image_broswer&type=big");
		Ex_Loader('modedialog',function(){
			return new imgDialog(url,{onCallback:function(image_id,image_src){
					 target.value=image_src;
			}})	;
		});
	};

	var panel = $('goods_shopmax_config');
	panel.getElements('label').setStyles({
		display:'block',
		lineHeight:25
	});
	panel.addEvent('click',function(e){
		var clickTarget = $(e.target);
		if(clickTarget.hasClass('new-btn')){
			e.stop();
			var newRow = new Element('div.division.clearfix',{
				html:panel.getElement('textarea.multi').value.substitute({_id:$time()})
			}).injectBefore(panel.getElement('hr'));

			newRow.getElements('label').setStyles({
					display:'block',
					lineHeight:25
			});
		}
		if(clickTarget.hasClass('nbtn')){
			e.stop();
			new Element('div.division.clearfix',{
				html:panel.getElement('textarea.ad').value.replace().substitute({_id:$time()})
			}).injectBefore(panel.getElement('#hr'));
		}
		if(clickTarget.hasClass('nbtnb')){
			e.stop();
			new Element('div.division.clearfix',{
				html:panel.getElement('textarea.bad').value.replace().substitute({_id:$time()})
			}).injectBefore(panel.getElement('#bhr'));
		}
		if(clickTarget.hasClass('nbtns')){
			e.stop();
			new Element('div.division.clearfix',{
				html:panel.getElement('textarea.sad').value.replace().substitute({_id:$time()})
			}).injectBefore(panel.getElement('#shr'));
		}
		if(clickTarget.hasClass('sbtn')){
			e.stop();
			load_photo_collect(clickTarget.getParent('div.span-auto').getElement('input[type=text]'));
		}

		if(clickTarget.hasClass('del-btn')){
			e.stop();
			if(confirm('确认删除?'))
			clickTarget.getParent('.division').dispose();
		}


		if(clickTarget.hasClass('goprev-btn')){
			e.stop();
			var item = clickTarget.getParent('.division'),
			      itemP = item.getPrevious('.division');
			     if(itemP){
			      	item.injectBefore(itemP);
			      }

		}

		if(clickTarget.hasClass('gonext-btn')){
			e.stop();
			var item = clickTarget.getParent('.division'),
			      itemN =item.getNext('.division');
			      if(itemN){
			      	item.injectAfter(itemN);
			      }


		}


	});

})();


    $$('#goods_shopmax_config .goods-selector-handle input[type=radio]').addEvent('change',function(){
        var radio  = this;
        if(!radio.checked)return;
        $$('#goods_shopmax_config .goods-selector [data-extend]').each(function(item){
            if(item.get('data-extend')!=radio.value){
                item.hide();
                }else{
                item.show();
            }
        });
    });
	 $$('#goods_shopmax_config .goods-selector-handle_r input[type=radio]').addEvent('change',function(){
        var radio  = this;
        if(!radio.checked)return;
        $$('#goods_shopmax_config .goods-selector_r [data-extend]').each(function(item){
            if(item.get('data-extend')!=radio.value){
                item.hide();
                }else{
                item.show();
            }
        });
    });
   function maxAddKeys(n){
	var content,
	i = new Date().getTime();
	content='\
	<ul class="items">\
		<li>栏目标题 <input class="x-input" type="text" name="keys['+i+'][text]" style="width:80px"></li>\
		<li>链接 <input class="x-input" type="text" name="keys['+i+'][url]" style="width:100px"></li>\
		<li>样式名 <input class="x-input" type="text" name="keys['+i+'][mcname]" style="width:80px"></li>\
		<li>新窗口 <input type="checkbox" name="keys['+i+'][target]" value="_blank"></li>\
		<li><button class="btn" type="button" onclick="maxAddKeys(this);"><span><span>在此项后填加</span></span></button></li>\
		<li><span class="delete" title="删除" onclick="delLink(this)" style="cursor:pointer;"}></span></li>\
	</ul>\
	';
	var newconfig=new Element('ul').set('html',content).getFirst();
	if(n==-1){
		newconfig.injectBottom($('maxKeys'));
	}else{
		newconfig.injectAfter(typeof n=='object' ? n.getParent('.items') : $('maxcTitle'));
	}
	}
delLink=function(o){
	$(o).getParent('.items').remove();
}

</script>